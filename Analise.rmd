---
title: "Adenocarcinoma da Próstata"
author: "Diogo Esteves (PG28935)"
output:
  html_document: default
  pdf_document: default
---
<style>
  p {
    text-align: justify;
  }
</style>

# 1ª Parte- Exploração inicial dos dados e análise de expressão diferencial e de enriquecimento

```{r,echo=FALSE,results='hide', warning = FALSE, message=FALSE, warning = FALSE, message=FALSE}
#install.packages("jpeg")
#install.packages("TCGAbiolinks")
#install.packages("Biobase")
#install.packages("DESeq2")
#install.packages("ggbeeswarm")
#install.packages("genefilter")
#install.packages("pheatmap")
#install.packages("org.Hs.eg.db")
#install.packages("fgsea")
#install.packages("ggplot2")
#install.packages("xfun")
#install.packages("SummarizedExperiment") 
#install.packages("factoextra")
#install.packages("Rtsne")
#install.packages("EBImage")
```

```{r,echo=FALSE,results='hide', warning = FALSE, message=FALSE,warning = FALSE, message=FALSE}
#library("jpeg")
#library("TCGAbiolinks")
#library("DESeq2")
#library("Biobase")
#library("DESeq2")
#library("ggbeeswarm")
#library("pheatmap")
#library("org.Hs.eg.db")
#library("fgsea")
#library("ggplot2")
#library("factoextra")
#library("limma")
#library("genefilter")
#library("SummarizedExperiment")
#library("Rtsne")
#library("party")
#library("rpart")
#library("caret") 
#library("rsample")

```

## Introdução - explicação teorica cancro da prostata, expressão genetica e RNAseq? (afunilem a informação à medida que escrevem uma introdução...)


```{r,echo=FALSE,results= 'markup', fig.cap= "Fig 1- Exemplo de figura",fig.align='center'}
image=readJPEG("nomedapic.jpg")

plot(0, 0, type = "n", xlim = c(0, 1), ylim = c(0, 1), xlab = "", ylab = "", axes= FALSE)
rasterImage(image, 0, 0, 1, 1)
```
## Origem dos dados aqui -

## Extração dos dados de transcriptómica e respetivos metadados da base de dados

Com o objetivo de analisar dados de transcriptómica relativos ao Adenocarcinoma do cancro da próstata, procedeu-se à extração de informação disponível no website cBioPortal. Este portal disponibiliza, de forma gratuita, uma ampla diversidade de alterações genómicas de vários tipos de cancro, incluindo o selecionado para estudo. Recorreu-se ao pacote TCGAbiolinks, dado que este método permite aceder aos dados do The Genomic Data Commons (GDC), uma rede de conhecimento sobre cancro que suporta a alojamento, normalização e análise de dados genómicos, clínicos e de biosspecimens provenientes de programas de investigação sobre cancro. A utilização do cBioPortal através do TCGAbiolinks possibilita a realização de consultas à base de dados, filtrando e selecionando conjuntos de dados específicos para, subsequentemente, proceder ao seu download.

```{r,results= 'markup'}
query_PRAD = GDCquery(
  project = "TCGA-PRAD",
  data.category = "Transcriptome Profiling", 
  data.type = "Gene Expression Quantification",
  workflow.type = "STAR - Counts"
)


GDCdownload(query=query_PRAD)


rna_seq_PRAD = GDCprepare(query = query, save = TRUE, save.filename = "mRNA_TCGA-PRAD.rda")
```

A função GDCquery() é utilizada para realizar a query à base dados. Nesta função são definidos vários parâmetros que permitem filtrar o data set que posteriormente vai ser descarregado. O parâmetro "project" corresponde ao id atribuído ao tipo de cancro de modo a apenas considerar a informação disponível referente ao carcinoma endométrio do corpo uterino. A "data.category" é usado para especificar a categoria de dados que se pretende selecionar, neste caso, como pretendemos realizar a análise da transcriptómica selecionou-se a categoria "Transcriptome Profiling" para selecionar os dados relacionados com o perfil de expressão de genes. De entre os dados do perfil de expressão de genes restringiu-se apenas aos dados referentes à quantificação da expressão de genes definindo "data.type" como Gene expression quantification. Por fim, indicou-se o tipo de análise da expressão genética desejada, optando-se por recorrer ao START-Counts. Este workflow indica que o algoritmo utilizado para a contagem da expressão genética a partir do alinhamento das sequências foi realizada com a ferramenta STAR.

A função GDCdownload() é utilizada para realizar o download dos dados consoante a query realizada e estabelecida na função anterior

#retorna a classe do objeto (tipo de dados ou a estrutura de dados que o objeto 
#representa, o que por sua vez determina quais funções podem ser aplicadas a ele)
class(rna_seq_PRAD)
#retorna as dimensões do objeto(matriz ou um dataframe;objeto mais complexo)
dim(rna_seq_PRAD)

#extrair componentes de um objeto por nome (através de colunas)
rna_seq_PRAD$paper_BCR
rna_seq_PRAD$paper_Gender
rna_seq_PRAD$paper_Grade
rna_seq_PRAD$paper_IDH.status

#atribui a um novo objeto chamado meta_PRAD, os metadados associados ao conjunto 
#de dados rna_seq_PRAD
meta_PRAD = colData(rna_seq_PRAD)
#retorna as dimensões dos metadados 
dim(meta_PRAD)
#extrair componentes de um objeto por nome (através de colunas)
meta_PRAD$patient
meta_PRAD$paper_IDH.status


##################################


#Análise de Expressão Diferencial com DESeq2
library(DESeq2)  #Nota: pacote DESeq2, uma ferramenta para análise de expressão diferencial de dados de contagem de sequenciamento de RNA (RNA-Seq)

#Filtra os dados de RNA para incluir apenas amostras não nulo
data_de <- rna_seq_PRAD[,!is.na(rna_seq_PRAD$paper_IDH.status)]

#Cria um objeto DESeqDataSet para análise, especificando um design experimental 
#que compara o status de IDH
ddsSE <- DESeqDataSet(data_de, design = ~ paper_IDH.status)

#Filtragem de Genes: Remove genes com contagens baixas (menos de 10) 
#para melhorar a confiabilidade da análise de expressão diferencial.
keep <- rowSums(counts(ddsSE)) >= 10

#Executa a análise de expressão diferencial com a função DESeq
ddsSE <- ddsSE[keep,]
ddsSE <- DESeq(ddsSE)

resultsNames(ddsSE)
#comparação "WT vs Mutant" para o status do IDH, e converte os resultados para um dataframe
res <- results(ddsSE, name = "paper_IDH.status_WT_vs_Mutant")
dea <- as.data.frame(res)
#resume os resultados para obter uma visão geral dos achados estatísticos, 
#como o número de genes significativamente diferencialmente expressos
summary(res)


#Processamento de Dados Clínicos com TCGAbiolinks
## dados clinicos

#buscar dados clínicos do projeto TCGA-PRAD (carcinoma endometrial uterino), 
#especificamente suplementos clínicos, através de GDCquery
query_clin <- GDCquery(project = "TCGA-PRAD", 
                       data.category = "Clinical",
                       data.type = "Clinical Supplement", 
                       data.format = "BCR Biotab")
#Baixa e prepara os dados clínicos
GDCdownload(query_clin)
clinical.PRAD <- GDCprepare(query_clin)
names(clinical.PRAD)

head (clinical.PRAD$clinical_drug_PRAD )
df = as.data.frame(clinical.PRAD$clinical_patient_PRAD)
View(df)
```


Todos os ficheiros a ser analisados têm em comum um "patient_ID", sendo que o ficheiro "data_clinical_patient" possui metadados relativos aos pacientes, o ficheiro "data_clinical_sample" possui metadados relativos à amostra e o ficheiro "data_mrna_seq_v2_rsem_zscores_ref_all_samples" possui dados normalizados relativos ao sequenciamento de mRNA. Outros ficheiros estão ao nosso dispor para complementar a nossa análise caso seja necessário numa fase posterior.

# Bibliografia

